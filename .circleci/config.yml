# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs:
  #slack: circleci/slack@4.1.4
  #aws-cli: circleci/aws-cli@1.3.0

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  Spinup-Test-Python:
    docker:
      - image: circleci/python:3.9.7-buster
    steps:
      - checkout
      - run:
          name: Check directory
          working_directory: ~/
          command: ls -la && pwd
      - run:
          name: Install cryptocmd application
          working_directory: ~/
          command: pip install cryptocmd
  Linting:
    docker:
      - image: circlci/python:3.9.7-buster
    steps:
      - checkout
      - run:
          name: Lint code files
          working_directory: ~/scripts
          command: ls -la
          
  Smoke-Test-application:
    docker:
      - image: circleci/python:3.9.7-buster
    steps:
      - checkout
      - run:
          name: install dependancies
          working_directory: ~/
          command: pip install cryptocmd pandas
      - run:
          name: test script
          working_directory: ~/scripts
          command: |
            python3 cryptotest.py

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
   Spinup-Test-Python:
    jobs:
      -  Spinup-Test-Python
      -  Linting
          requires: [Spinup-Test-Python]
      -  Smoke-Test-application
          requires: [Linting]
